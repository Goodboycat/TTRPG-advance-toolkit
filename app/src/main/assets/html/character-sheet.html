<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Character Sheets - TTRPG Toolkit</title>
    <link rel="stylesheet" href="file:///android_asset/css/style.css">
</head>
<body>
    <nav class="navbar">
        <h1>TTRPG Toolkit</h1>
        <div class="nav-tabs">
            <a href="index.html">Dashboard</a>
            <a href="dice-roller.html">Dice</a>
            <a href="character-sheet.html" class="active">Characters</a>
            <a href="random-generator.html">Generators</a>
            <a href="notes.html">Notes</a>
            <a href="map.html">Map</a>
            <a href="battle.html">Battle</a>
            <a href="database.html">Database</a>
            <a href="multiplayer.html">Multiplayer</a>
            <a href="settings.html">Settings</a>
        </div>
    </nav>

    <main class="container">
        <section class="card">
            <h2 contenteditable="true">Character List</h2>
            <div id="characterList" class="character-list"></div>
            <div class="character-actions">
                <button onclick="createCharacter()" class="btn-primary" contenteditable="true">New Character</button>
                <button onclick="showTemplateSelection()" class="btn-secondary" contenteditable="true">From Template</button>
                <button onclick="generateRandomCharacter()" class="btn-secondary" contenteditable="true">Random Character</button>
            </div>
        </section>

        <section class="card" id="characterEditor" style="display: none;">
            <h2 contenteditable="true">Character Editor</h2>
            <div class="char-header">
                <div class="form-group">
                    <label contenteditable="true">Name:</label>
                    <input type="text" id="charName" placeholder="Character Name">
                </div>
                <div class="form-group">
                    <label contenteditable="true">Race:</label>
                    <input type="text" id="charRace" placeholder="Character Race" list="raceList">
                </div>
                <div class="form-group">
                    <label contenteditable="true">Class:</label>
                    <input type="text" id="charClass" placeholder="Character Class" list="classList">
                </div>
                <div class="form-group">
                    <label contenteditable="true">Level:</label>
                    <input type="number" id="charLevel" value="1" min="1" max="30">
                </div>
            </div>

            <div class="stats-section">
                <div class="section-header">
                    <h3 contenteditable="true">Attributes</h3>
                    <div class="stat-controls">
                        <button onclick="addCustomStat()" class="btn-secondary" contenteditable="true">Add Stat</button>
                        <button onclick="generateStats()" class="btn-secondary" contenteditable="true">Generate Stats</button>
                    </div>
                </div>
                <div class="stats-grid" id="statsGrid">
                    <!-- Stats will be generated by main.js -->
                </div>
            </div>

            <div class="skills-section">
                <div class="section-header">
                    <h3 contenteditable="true">Skills & Abilities</h3>
                    <button onclick="showSkillGenerator()" class="btn-secondary" contenteditable="true">Generate Skills</button>
                </div>
                <div id="skillsList" class="skills-list">
                    <!-- Skills will be loaded here -->
                </div>
                <button onclick="addSkill()" class="btn-secondary" contenteditable="true">Add Skill</button>
            </div>

            <div class="combat-stats">
                <h3 contenteditable="true">Combat Stats</h3>
                <div class="combat-grid">
                    <div class="form-group">
                        <label contenteditable="true">HP:</label>
                        <input type="number" id="charHP" value="10" min="1">
                        <span contenteditable="true">/</span>
                        <input type="number" id="charMaxHP" value="10" min="1">
                    </div>
                    <div class="form-group">
                        <label contenteditable="true">AC:</label>
                        <input type="number" id="charAC" value="10" min="1">
                    </div>
                    <div class="form-group">
                        <label contenteditable="true">Speed:</label>
                        <input type="number" id="charSpeed" value="30" min="0">
                    </div>
                    <div class="form-group">
                        <label contenteditable="true">Initiative:</label>
                        <input type="number" id="charInitiative" value="0">
                    </div>
                </div>
            </div>

            <div class="notes-section">
                <h3 contenteditable="true">Notes & Background</h3>
                <textarea id="charNotes" placeholder="Character background, personality, notes..."></textarea>
            </div>

            <div class="button-group">
                <button onclick="saveCharacter()" class="btn-primary" contenteditable="true">Save Character</button>
                <button onclick="duplicateCharacter()" class="btn-secondary" contenteditable="true">Duplicate</button>
                <button onclick="exportCharacter()" class="btn-secondary" contenteditable="true">Export</button>
                <button onclick="deleteCharacter()" class="btn-danger" contenteditable="true">Delete</button>
                <button onclick="closeEditor()" class="btn-secondary" contenteditable="true">Close</button>
            </div>
        </section>

        <!-- Template Selection Modal -->
        <div id="templateModal" class="modal" style="display: none;">
            <div class="modal-content">
                <h2 contenteditable="true">Choose Character Template</h2>
                <div class="template-list">
                    <div class="template-item" onclick="createFromTemplate('dnd5e')">
                        <h4 contenteditable="true">D&D 5e</h4>
                        <p contenteditable="true">Standard D&D 5th edition template with STR, DEX, CON, INT, WIS, CHA</p>
                    </div>
                    <div class="template-item" onclick="createFromTemplate('pathfinder')">
                        <h4 contenteditable="true">Pathfinder</h4>
                        <p contenteditable="true">Pathfinder RPG template with additional skills and feats</p>
                    </div>
                    <div class="template-item" onclick="createFromTemplate('shadowrun')">
                        <h4 contenteditable="true">Shadowrun</h4>
                        <p contenteditable="true">Cyberpunk fantasy with Body, Agility, Reaction, Strength, etc.</p>
                    </div>
                    <div class="template-item" onclick="createFromTemplate('custom')">
                        <h4 contenteditable="true">Custom</h4>
                        <p contenteditable="true">Create your own stat template</p>
                    </div>
                </div>
                <button onclick="closeTemplateModal()" class="btn-secondary" contenteditable="true">Cancel</button>
            </div>
        </div>

        <!-- Skill Generator Modal -->
        <div id="skillModal" class="modal" style="display: none;">
            <div class="modal-content">
                <h2 contenteditable="true">Generate Skills from Database</h2>
                <div class="skill-filters">
                    <div class="form-group">
                        <label contenteditable="true">Filter by Type:</label>
                        <select id="skillTypeFilter">
                            <option value="all">All Skills</option>
                            <option value="combat">Combat</option>
                            <option value="magic">Magic</option>
                            <option value="utility">Utility</option>
                            <option value="social">Social</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label contenteditable="true">Max Skills:</label>
                        <input type="number" id="maxSkills" value="5" min="1" max="20">
                    </div>
                </div>
                <div id="availableSkills" class="available-skills">
                    <!-- Skills from database will appear here -->
                </div>
                <div class="modal-actions">
                    <button onclick="addSelectedSkills()" class="btn-primary" contenteditable="true">Add Selected</button>
                    <button onclick="closeSkillModal()" class="btn-secondary" contenteditable="true">Cancel</button>
                </div>
            </div>
        </div>

        <datalist id="raceList"></datalist>
        <datalist id="classList"></datalist>
    </main>

    <script src="file:///android_asset/js/main.js"></script>
    <script>
        let characters = JSON.parse(localStorage.getItem('characters') || '[]');
        let currentCharacterId = null;
        let availableRaces = [];
        let availableClasses = [];
        let availableSkills = [];

        // Character templates
        const characterTemplates = {
            dnd5e: {
                stats: ['STR', 'DEX', 'CON', 'INT', 'WIS', 'CHA'],
                skills: ['Acrobatics', 'Arcana', 'Athletics', 'Deception', 'History', 'Insight', 'Intimidation', 'Investigation', 'Medicine', 'Nature', 'Perception', 'Performance', 'Persuasion', 'Religion', 'Sleight of Hand', 'Stealth', 'Survival']
            },
            pathfinder: {
                stats: ['STR', 'DEX', 'CON', 'INT', 'WIS', 'CHA'],
                skills: ['Acrobatics', 'Appraise', 'Bluff', 'Climb', 'Craft', 'Diplomacy', 'Disable Device', 'Disguise', 'Escape Artist', 'Fly', 'Handle Animal', 'Heal', 'Intimidate', 'Knowledge (Arcana)', 'Knowledge (Dungeoneering)', 'Knowledge (Engineering)', 'Knowledge (Geography)', 'Knowledge (History)', 'Knowledge (Local)', 'Knowledge (Nature)', 'Knowledge (Nobility)', 'Knowledge (Planes)', 'Knowledge (Religion)', 'Linguistics', 'Perception', 'Perform', 'Profession', 'Ride', 'Sense Motive', 'Sleight of Hand', 'Spellcraft', 'Stealth', 'Survival', 'Swim', 'Use Magic Device']
            },
            shadowrun: {
                stats: ['Body', 'Agility', 'Reaction', 'Strength', 'Willpower', 'Logic', 'Intuition', 'Charisma', 'Edge', 'Essence', 'Magic', 'Resonance'],
                skills: ['Athletics', 'Biotech', 'Close Combat', 'Con', 'Cracking', 'Electronics', 'Firearms', 'Negotiation', 'Piloting', 'Sorcery', 'Stealth', 'Tasking', 'Engineering', 'Outdoors', 'Influence', 'Enchanting']
            },
            custom: {
                stats: [],
                skills: []
            }
        };

        document.addEventListener('DOMContentLoaded', function() {
            loadCharacterList();
            loadDatabaseReferences();
        });

        function loadDatabaseReferences() {
            // Load races and classes from database for autocomplete
            const database = JSON.parse(localStorage.getItem('gameDatabase') || '{}');
            
            availableRaces = (database.races || []).map(race => race.name);
            availableClasses = (database.classes || []).map(cls => cls.name);
            availableSkills = (database.skills || []).map(skill => skill.name);
            
            // Populate datalists
            const raceList = document.getElementById('raceList');
            const classList = document.getElementById('classList');
            
            raceList.innerHTML = availableRaces.map(race => `<option value="${race}">`).join('');
            classList.innerHTML = availableClasses.map(cls => `<option value="${cls}">`).join('');
        }

        function loadCharacterList() {
            const container = document.getElementById('characterList');
            if (characters.length === 0) {
                container.innerHTML = '<p contenteditable="true">No characters yet. Create your first!</p>';
                return;
            }
            container.innerHTML = characters.map(char => `
                <div class="character-item" onclick="editCharacter('${char.id}')">
                    <div class="char-basic-info">
                        <span class="char-name" contenteditable="true">${char.name || 'Unnamed'}</span>
                        <span class="char-details" contenteditable="true">${char.race || ''} ${char.class || ''} Lvl ${char.level || 1}</span>
                    </div>
                    <div class="char-stats-preview">
                        ${Object.entries(char.stats || {}).slice(0, 3).map(([stat, value]) => `
                            <span class="stat-preview" contenteditable="true">${stat} ${value}</span>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function createCharacter() {
            const characterStats = JSON.parse(localStorage.getItem('characterStats') || '["STR","DEX","CON","INT","WIS","CHA"]');
            const newChar = {
                id: Date.now().toString(),
                name: 'New Character',
                race: '',
                class: '',
                level: 1,
                stats: {},
                skills: [],
                combat: {
                    hp: 10,
                    maxHP: 10,
                    ac: 10,
                    speed: 30,
                    initiative: 0
                },
                notes: ''
            };
            
            // Initialize stats from current settings
            characterStats.forEach(stat => {
                newChar.stats[stat] = 10;
            });
            
            characters.push(newChar);
            localStorage.setItem('characters', JSON.stringify(characters));
            editCharacter(newChar.id);
            loadCharacterList();
        }

        function showTemplateSelection() {
            document.getElementById('templateModal').style.display = 'flex';
        }

        function closeTemplateModal() {
            document.getElementById('templateModal').style.display = 'none';
        }

        function createFromTemplate(templateName) {
            const template = characterTemplates[templateName];
            const newChar = {
                id: Date.now().toString(),
                name: `New ${templateName.charAt(0).toUpperCase() + templateName.slice(1)} Character`,
                race: '',
                class: '',
                level: 1,
                stats: {},
                skills: template.skills.map(skill => ({ name: skill, value: '+0' })),
                combat: {
                    hp: 10,
                    maxHP: 10,
                    ac: 10,
                    speed: 30,
                    initiative: 0
                },
                notes: ''
            };
            
            // Initialize stats from template
            template.stats.forEach(stat => {
                newChar.stats[stat] = 10;
            });
            
            // Save template as current stat settings
            localStorage.setItem('characterStats', JSON.stringify(template.stats));
            
            characters.push(newChar);
            localStorage.setItem('characters', JSON.stringify(characters));
            editCharacter(newChar.id);
            loadCharacterList();
            closeTemplateModal();
            
            // Reload global settings to update stats grid
            loadGlobalSettings();
        }

        function generateRandomCharacter() {
            const races = ['Human', 'Elf', 'Dwarf', 'Halfling', 'Gnome', 'Half-Elf', 'Half-Orc', 'Tiefling'];
            const classes = ['Fighter', 'Wizard', 'Rogue', 'Cleric', 'Ranger', 'Paladin', 'Barbarian', 'Bard'];
            const names = ['Aelar', 'Borin', 'Celia', 'Darian', 'Elena', 'Fargrim', 'Gwen', 'Hakon'];
            
            const newChar = {
                id: Date.now().toString(),
                name: names[Math.floor(Math.random() * names.length)],
                race: races[Math.floor(Math.random() * races.length)],
                class: classes[Math.floor(Math.random() * classes.length)],
                level: Math.floor(Math.random() * 10) + 1,
                stats: {},
                skills: [],
                combat: {
                    hp: Math.floor(Math.random() * 50) + 10,
                    maxHP: 0,
                    ac: Math.floor(Math.random() * 10) + 10,
                    speed: 30,
                    initiative: Math.floor(Math.random() * 5)
                },
                notes: 'Randomly generated character'
            };
            
            // Generate random stats (3d6 method)
            const characterStats = JSON.parse(localStorage.getItem('characterStats') || '["STR","DEX","CON","INT","WIS","CHA"]');
            characterStats.forEach(stat => {
                let total = 0;
                let min = 6;
                for (let i = 0; i < 3; i++) {
                    const roll = Math.floor(Math.random() * 6) + 1;
                    total += roll;
                    if (roll < min) min = roll;
                }
                // Drop lowest and add
                newChar.stats[stat] = total - min + 3; // +3 to make stats more reasonable
            });
            
            newChar.combat.maxHP = newChar.combat.hp;
            
            characters.push(newChar);
            localStorage.setItem('characters', JSON.stringify(characters));
            editCharacter(newChar.id);
            loadCharacterList();
            showNotification('Random character generated!', 'success');
        }

        function editCharacter(id) {
            currentCharacterId = id;
            const char = characters.find(c => c.id === id);
            if (!char) return;
            
            document.getElementById('charName').value = char.name || '';
            document.getElementById('charRace').value = char.race || '';
            document.getElementById('charClass').value = char.class || '';
            document.getElementById('charLevel').value = char.level || 1;
            document.getElementById('charNotes').value = char.notes || '';
            
            // Load combat stats
            if (char.combat) {
                document.getElementById('charHP').value = char.combat.hp || 10;
                document.getElementById('charMaxHP').value = char.combat.maxHP || 10;
                document.getElementById('charAC').value = char.combat.ac || 10;
                document.getElementById('charSpeed').value = char.combat.speed || 30;
                document.getElementById('charInitiative').value = char.combat.initiative || 0;
            }
            
            // Load stats - regenerate from current settings first
            const characterStats = JSON.parse(localStorage.getItem('characterStats') || '["STR","DEX","CON","INT","WIS","CHA"]');
            const statsGrid = document.getElementById('statsGrid');
            
            statsGrid.innerHTML = characterStats.map(stat => {
                const value = char.stats[stat] || 10;
                const mod = Math.floor((value - 10) / 2);
                return `
                    <div class="stat-item" data-stat="${stat}">
                        <label contenteditable="true">${stat}:</label>
                        <input type="number" value="${value}" min="1" max="30" onchange="updateStatMod(this)">
                        <span class="stat-mod">${mod >= 0 ? '+' : ''}${mod}</span>
                        <button onclick="removeStat('${stat}')" class="btn-danger stat-remove">X</button>
                    </div>
                `;
            }).join('');
            
            // Load custom stats that aren't in the template
            Object.keys(char.stats).forEach(stat => {
                if (!characterStats.includes(stat)) {
                    const value = char.stats[stat];
                    const mod = Math.floor((value - 10) / 2);
                    const statItem = document.createElement('div');
                    statItem.className = 'stat-item';
                    statItem.dataset.stat = stat;
                    statItem.innerHTML = `
                        <label contenteditable="true">${stat}:</label>
                        <input type="number" value="${value}" min="1" max="30" onchange="updateStatMod(this)">
                        <span class="stat-mod">${mod >= 0 ? '+' : ''}${mod}</span>
                        <button onclick="removeStat('${stat}')" class="btn-danger stat-remove">X</button>
                    `;
                    statsGrid.appendChild(statItem);
                }
            });
            
            // Load skills
            const skillsContainer = document.getElementById('skillsList');
            if (char.skills && char.skills.length > 0) {
                skillsContainer.innerHTML = char.skills.map(skill => `
                    <div class="skill-item">
                        <span contenteditable="true" class="skill-name">${skill.name}</span>
                        <span contenteditable="true" class="skill-value">${skill.value}</span>
                        <button onclick="removeSkill(this)" class="btn-danger">X</button>
                    </div>
                `).join('');
            } else {
                skillsContainer.innerHTML = '<p contenteditable="true">No skills yet. Add some!</p>';
            }
            
            document.getElementById('characterEditor').style.display = 'block';
        }

        function updateStatMod(input) {
            const value = parseInt(input.value) || 10;
            const mod = Math.floor((value - 10) / 2);
            const modSpan = input.nextElementSibling;
            if (modSpan && modSpan.classList.contains('stat-mod')) {
                modSpan.textContent = `${mod >= 0 ? '+' : ''}${mod}`;
            }
        }

        function addCustomStat() {
            const statName = prompt('Enter new stat name:');
            if (statName && statName.trim()) {
                const statsGrid = document.getElementById('statsGrid');
                const statItem = document.createElement('div');
                statItem.className = 'stat-item';
                statItem.dataset.stat = statName;
                statItem.innerHTML = `
                    <label contenteditable="true">${statName}:</label>
                    <input type="number" value="10" min="1" max="30" onchange="updateStatMod(this)">
                    <span class="stat-mod">+0</span>
                    <button onclick="removeStat('${statName}')" class="btn-danger stat-remove">X</button>
                `;
                statsGrid.appendChild(statItem);
            }
        }

        function removeStat(statName) {
            if (confirm(`Remove stat "${statName}"?`)) {
                const statItem = document.querySelector(`.stat-item[data-stat="${statName}"]`);
                if (statItem) {
                    statItem.remove();
                }
            }
        }

        function generateStats() {
            const method = prompt('Choose stat generation method:\n1. Standard Array (15,14,13,12,10,8)\n2. Point Buy (27 points)\n3. Random (4d6 drop lowest)', '1');
            
            const statsGrid = document.getElementById('statsGrid');
            const statItems = statsGrid.querySelectorAll('.stat-item');
            let stats = [];
            
            switch(method) {
                case '1': // Standard Array
                    stats = [15, 14, 13, 12, 10, 8];
                    break;
                case '2': // Point Buy
                    stats = Array(6).fill(8);
                    let points = 27;
                    while (points > 0) {
                        const index = Math.floor(Math.random() * 6);
                        if (stats[index] < 15) {
                            stats[index]++;
                            points--;
                        }
                    }
                    break;
                case '3': // Random (4d6 drop lowest)
                default:
                    stats = Array(6).fill(0).map(() => {
                        const rolls = Array(4).fill(0).map(() => Math.floor(Math.random() * 6) + 1);
                        rolls.sort((a, b) => a - b);
                        return rolls.slice(1).reduce((a, b) => a + b, 0);
                    });
                    break;
            }
            
            // Shuffle and assign to stats
            stats.sort(() => Math.random() - 0.5);
            statItems.forEach((item, index) => {
                if (index < stats.length) {
                    const input = item.querySelector('input[type="number"]');
                    input.value = stats[index];
                    updateStatMod(input);
                }
            });
            
            showNotification('Stats generated!', 'success');
        }

        function showSkillGenerator() {
            const database = JSON.parse(localStorage.getItem('gameDatabase') || '{}');
            const skills = database.skills || [];
            
            const container = document.getElementById('availableSkills');
            if (skills.length === 0) {
                container.innerHTML = '<p contenteditable="true">No skills in database. Add some in the Database section first.</p>';
            } else {
                container.innerHTML = skills.map(skill => `
                    <div class="skill-option">
                        <input type="checkbox" id="skill-${skill.id}" value="${skill.id}">
                        <label for="skill-${skill.id}">
                            <strong contenteditable="true">${skill.name}</strong>
                            <span contenteditable="true"> - ${skill.description || 'No description'}</span>
                        </label>
                    </div>
                `).join('');
            }
            
            document.getElementById('skillModal').style.display = 'flex';
        }

        function closeSkillModal() {
            document.getElementById('skillModal').style.display = 'none';
        }

        function addSelectedSkills() {
            const selectedSkills = document.querySelectorAll('#availableSkills input[type="checkbox"]:checked');
            const database = JSON.parse(localStorage.getItem('gameDatabase') || '{}');
            const skills = database.skills || [];
            
            selectedSkills.forEach(checkbox => {
                const skillId = checkbox.value;
                const skill = skills.find(s => s.id === skillId);
                if (skill) {
                    addSkillToCharacter(skill.name, '+0');
                }
            });
            
            closeSkillModal();
            showNotification(`Added ${selectedSkills.length} skills`, 'success');
        }

        function addSkillToCharacter(name, value) {
            const skillsContainer = document.getElementById('skillsList');
            if (skillsContainer.innerHTML.includes('No skills yet')) {
                skillsContainer.innerHTML = '';
            }
            
            const skillItem = document.createElement('div');
            skillItem.className = 'skill-item';
            skillItem.innerHTML = `
                <span contenteditable="true" class="skill-name">${name}</span>
                <span contenteditable="true" class="skill-value">${value}</span>
                <button onclick="removeSkill(this)" class="btn-danger">X</button>
            `;
            skillsContainer.appendChild(skillItem);
        }

        // ... rest of the existing functions (saveCharacter, deleteCharacter, closeEditor, addSkill, removeSkill) ...

        function saveCharacter() {
            const char = characters.find(c => c.id === currentCharacterId);
            if (!char) return;
            
            char.name = document.getElementById('charName').value;
            char.race = document.getElementById('charRace').value;
            char.class = document.getElementById('charClass').value;
            char.level = parseInt(document.getElementById('charLevel').value) || 1;
            char.notes = document.getElementById('charNotes').value;
            
            // Save combat stats
            char.combat = {
                hp: parseInt(document.getElementById('charHP').value) || 10,
                maxHP: parseInt(document.getElementById('charMaxHP').value) || 10,
                ac: parseInt(document.getElementById('charAC').value) || 10,
                speed: parseInt(document.getElementById('charSpeed').value) || 30,
                initiative: parseInt(document.getElementById('charInitiative').value) || 0
            };
            
            // Save stats
            char.stats = {};
            document.querySelectorAll('.stat-item').forEach(item => {
                const statName = item.dataset.stat;
                const value = parseInt(item.querySelector('input').value) || 10;
                char.stats[statName] = value;
            });
            
            // Save skills
            const skillItems = document.querySelectorAll('.skill-item');
            char.skills = Array.from(skillItems).map(item => ({
                name: item.querySelector('.skill-name').textContent,
                value: item.querySelector('.skill-value').textContent
            }));
            
            localStorage.setItem('characters', JSON.stringify(characters));
            loadCharacterList();
            showNotification('Character saved!', 'success');
        }

        function duplicateCharacter() {
            const char = characters.find(c => c.id === currentCharacterId);
            if (!char) return;
            
            const newChar = JSON.parse(JSON.stringify(char));
            newChar.id = Date.now().toString();
            newChar.name = char.name + ' (Copy)';
            
            characters.push(newChar);
            localStorage.setItem('characters', JSON.stringify(characters));
            editCharacter(newChar.id);
            loadCharacterList();
            showNotification('Character duplicated!', 'success');
        }

        function exportCharacter() {
            const char = characters.find(c => c.id === currentCharacterId);
            if (!char) return;
            
            const exportData = JSON.stringify(char, null, 2);
            const blob = new Blob([exportData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `${char.name.replace(/[^a-z0-9]/gi, '_').toLowerCase()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Character exported!', 'success');
        }

        function deleteCharacter() {
            if (!currentCharacterId) return;
            if (!confirm('Delete this character?')) return;
            
            characters = characters.filter(c => c.id !== currentCharacterId);
            localStorage.setItem('characters', JSON.stringify(characters));
            currentCharacterId = null;
            document.getElementById('characterEditor').style.display = 'none';
            loadCharacterList();
            showNotification('Character deleted!', 'success');
        }

        function closeEditor() {
            document.getElementById('characterEditor').style.display = 'none';
            currentCharacterId = null;
        }

        function addSkill() {
            const skillsContainer = document.getElementById('skillsList');
            if (skillsContainer.innerHTML.includes('No skills yet')) {
                skillsContainer.innerHTML = '';
            }
            
            const newSkill = document.createElement('div');
            newSkill.className = 'skill-item';
            newSkill.innerHTML = `
                <span contenteditable="true" class="skill-name">New Skill</span>
                <span contenteditable="true" class="skill-value">+0</span>
                <button onclick="removeSkill(this)" class="btn-danger">X</button>
            `;
            skillsContainer.appendChild(newSkill);
        }

        function removeSkill(button) {
            button.parentElement.remove();
        }
    </script>

    <style>
        .character-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .char-basic-info {
            flex: 1;
        }

        .char-details {
            display: block;
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 0.25rem;
        }

        .char-stats-preview {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .stat-preview {
            background: var(--bg-primary);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .stat-controls {
            display: flex;
            gap: 0.5rem;
        }

        .stats-grid {
            display: grid;
            gap: 0.5rem;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            background: var(--bg-secondary);
            border-radius: 4px;
            position: relative;
        }

        .stat-item label {
            min-width: 60px;
            margin: 0;
        }

        .stat-item input {
            width: 60px;
        }

        .stat-mod {
            font-weight: bold;
            color: var(--accent);
            min-width: 40px;
        }

        .stat-remove {
            padding: 0.25rem 0.5rem;
            font-size: 0.8rem;
            margin-left: auto;
        }

        .combat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .combat-grid .form-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .combat-grid input {
            width: 70px;
        }

        .template-list {
            display: grid;
            gap: 1rem;
            margin: 1rem 0;
        }

        .template-item {
            background: var(--bg-secondary);
            padding: 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid var(--accent);
        }

        .template-item:hover {
            background: var(--accent);
            color: var(--bg-primary);
        }

        .template-item h4 {
            margin: 0 0 0.5rem 0;
            color: inherit;
        }

        .skill-filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .available-skills {
            max-height: 300px;
            overflow-y: auto;
            background: var(--bg-secondary);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .skill-option {
            padding: 0.5rem;
            border-bottom: 1px solid var(--border);
        }

        .skill-option:last-child {
            border-bottom: none;
        }

        .skill-option input {
            margin-right: 0.5rem;
        }

        @media (max-width: 768px) {
            .character-actions {
                flex-direction: column;
            }
            
            .section-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .stat-controls {
                width: 100%;
                justify-content: space-between;
            }
            
            .combat-grid {
                grid-template-columns: 1fr;
            }
            
            .char-stats-preview {
                justify-content: center;
            }
            
            .stat-item {
                flex-wrap: wrap;
            }
            
            .skill-filters {
                flex-direction: column;
            }
        }
    </style>
</body>
</html>
