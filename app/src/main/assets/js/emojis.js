// Enhanced TTRPG Emoji Library for Maps, Tags, and World-Building

window.TTRPGEmojis = {
    // Adventure & Equipment
    adventure: [
        'âš”ï¸', 'ðŸ›¡ï¸', 'ðŸ¹', 'ðŸ—¡ï¸', 'ðŸ”®', 'ðŸ“œ', 'ðŸ—ï¸', 'ðŸ’Ž', 'ðŸ†', 'ðŸ‘‘',
        'âš±ï¸', 'ðŸº', 'ðŸ“¦', 'ðŸŽ', 'ðŸ’¼', 'ðŸ§­', 'ðŸ•¯ï¸', 'ðŸ’¡', 'ðŸ”¦', 'ðŸ•¯ï¸'
    ],
    
    // Weapons & Combat
    weapons: [
        'ðŸ—¡ï¸', 'âš”ï¸', 'ðŸ¹', 'ðŸ”«', 'ðŸª“', 'ðŸ”¨', 'ðŸ—œï¸', 'âš’ï¸', 'ðŸ› ï¸', 'â›ï¸',
        'ðŸ”ª', 'ðŸ’£', 'ðŸ§¨', 'ðŸŽ¯', 'ðŸ›¡ï¸', 'ðŸ´', 'ðŸš©', 'ðŸŽŒ', 'ðŸ³ï¸', 'âš”ï¸'
    ],
    
    // Magic & Spells
    magic: [
        'ðŸ”®', 'âœ¨', 'ðŸŒŸ', 'ðŸ’«', 'â­', 'â˜„ï¸', 'ðŸŒ ', 'ðŸ’¥', 'ðŸ”¥', 'â„ï¸',
        'ðŸ’§', 'ðŸŒªï¸', 'âš¡', 'ðŸŒˆ', 'â˜€ï¸', 'ðŸŒ™', 'ðŸ’Ž', 'ðŸ”±', 'â™¾ï¸', 'ðŸ“œ'
    ],
    
    // Creatures & Monsters
    creatures: [
        'ðŸ‰', 'ðŸ²', 'ðŸ¦–', 'ðŸ¦•', 'ðŸŠ', 'ðŸ', 'ðŸ¦Ž', 'ðŸ¢', 'ðŸ¦…', 'ðŸ¦‰',
        'ðŸº', 'ðŸ¦Š', 'ðŸ—', 'ðŸ»', 'ðŸ¦Œ', 'ðŸ˜', 'ðŸ¦', 'ðŸ¦›', 'ðŸ«', 'ðŸ¦’',
        'ðŸ¦˜', 'ðŸŽ', 'ðŸ¦„', 'ðŸ‚', 'ðŸƒ', 'ðŸ„', 'ðŸ', 'ðŸ‘', 'ðŸ', 'ðŸ¦™'
    ],
    
    // Fantasy Races
    races: [
        'ðŸ§', 'ðŸ§™', 'ðŸ§Œ', 'ðŸ§š', 'ðŸ§›', 'ðŸ§œ', 'ðŸ§ž', 'ðŸ§Ÿ', 'ðŸ‘¹', 'ðŸ‘º',
        'ðŸ¤´', 'ðŸ‘¸', 'ðŸ¦¸', 'ðŸ¦¹', 'ðŸ§', 'ðŸ§™', 'ðŸ§š', 'ðŸ§›', 'ðŸ§œ', 'ðŸ§ž'
    ],
    
    // Locations & Places
    locations: [
        'ðŸ°', 'ðŸ¯', 'ðŸ—¼', 'ðŸ›ï¸', 'â›ª', 'ðŸ•Œ', 'ðŸ›•', 'ðŸ•', 'ðŸ ', 'ðŸ¡',
        'ðŸ¢', 'ðŸ£', 'ðŸ¤', 'ðŸ¥', 'ðŸ¦', 'ðŸ¨', 'ðŸ©', 'ðŸª', 'ðŸ«', 'ðŸ¬',
        'ðŸ­', 'ðŸ®', 'ðŸ—¿', 'ðŸŸï¸', 'ðŸŽª', 'ðŸŽ­', 'ðŸ›–', 'â›º', 'ðŸ•ï¸', 'ðŸŒ‹'
    ],
    
    // Nature & Environment
    nature: [
        'ðŸŒ²', 'ðŸŒ³', 'ðŸŒ´', 'ðŸŒ±', 'ðŸŒ¿', 'â˜˜ï¸', 'ðŸ€', 'ðŸŽ', 'ðŸŽ‹', 'ðŸƒ',
        'ðŸ‚', 'ðŸ', 'ðŸŒ¾', 'ðŸŒ·', 'ðŸŒ¹', 'ðŸ¥€', 'ðŸŒº', 'ðŸŒ¸', 'ðŸŒ¼', 'ðŸŒ»',
        'ðŸŒµ', 'ðŸŽ„', 'ðŸŒŠ', 'ðŸŒ‹', 'ðŸ”ï¸', 'â›°ï¸', 'ðŸŒ„', 'ðŸŒ…', 'ðŸŒŒ', 'ðŸŒ '
    ],
    
    // NPC & Characters
    npc: [
        'ðŸ‘¤', 'ðŸ‘¥', 'ðŸ§‘', 'ðŸ‘¨', 'ðŸ‘©', 'ðŸ§”', 'ðŸ‘´', 'ðŸ‘µ', 'ðŸ‘¦', 'ðŸ‘§',
        'ðŸ§’', 'ðŸ‘¶', 'ðŸ‘®', 'ðŸ’‚', 'ðŸ‘·', 'ðŸ¤´', 'ðŸ‘¸', 'ðŸ¦¸', 'ðŸ¦¹', 'ðŸ§™'
    ],
    
    // Items & Tools
    items: [
        'ðŸ”§', 'ðŸª›', 'ðŸ”¨', 'â›ï¸', 'ðŸª“', 'ðŸªš', 'ðŸ”©', 'âš™ï¸', 'â›“ï¸', 'ðŸª',
        'ðŸ§°', 'ðŸ§²', 'ðŸªœ', 'ðŸ—‘ï¸', 'ðŸ›’', 'ðŸ›–', 'â›½', 'ðŸ›¢ï¸', 'ðŸ’ˆ', 'ðŸ§´'
    ],
    
    // Status & Conditions
    status: [
        'â¤ï¸', 'ðŸ’™', 'ðŸ’š', 'ðŸ’›', 'ðŸ’œ', 'ðŸ–¤', 'ðŸ’”', 'â£ï¸', 'ðŸ’•', 'ðŸ’ž',
        'ðŸ’“', 'ðŸ’—', 'ðŸ’–', 'ðŸ’˜', 'ðŸ’', 'ðŸ”´', 'ðŸŸ ', 'ðŸŸ¡', 'ðŸŸ¢', 'ðŸ”µ'
    ],
    
    // Symbols & UI
    symbols: [
        'â“', 'â—', 'âš ï¸', 'âšœï¸', 'ðŸ”±', 'â­•', 'âŒ', 'ðŸ’ ', 'ðŸ”°', 'â™¨ï¸',
        'ðŸ’¤', 'ðŸŒ€', 'â™¿', 'ðŸš¹', 'ðŸšº', 'ðŸš»', 'ðŸš¼', 'ðŸš¾', 'ðŸ›‚', 'ðŸ›ƒ'
    ],
    
    // Food & Consumables
    food: [
        'ðŸŽ', 'ðŸ', 'ðŸŠ', 'ðŸ‹', 'ðŸŒ', 'ðŸ‰', 'ðŸ‡', 'ðŸ“', 'ðŸ«', 'ðŸˆ',
        'ðŸ’', 'ðŸ‘', 'ðŸ¥­', 'ðŸ', 'ðŸ¥¥', 'ðŸ¥', 'ðŸ…', 'ðŸ†', 'ðŸ¥‘', 'ðŸ¥¦'
    ],
    
    // Time & Weather
    time: [
        'ðŸŒž', 'ðŸŒ', 'ðŸŒ›', 'ðŸŒœ', 'ðŸŒ™', 'â­', 'ðŸŒŸ', 'ðŸŒ ', 'ðŸŒŒ', 'â˜€ï¸',
        'ðŸŒ¤ï¸', 'â›…', 'ðŸŒ¥ï¸', 'â˜ï¸', 'ðŸŒ¦ï¸', 'ðŸŒ§ï¸', 'â›ˆï¸', 'ðŸŒ©ï¸', 'ðŸŒ¨ï¸', 'â„ï¸'
    ]
};

// Enhanced emoji utility functions
window.TTRPGEmojiUtils = {
    // Get emoji by category
    getByCategory: function(category) {
        return TTRPGEmojis[category] || [];
    },

    // Get all emojis as flat array
    getAll: function() {
        return Object.values(TTRPGEmojis).flat();
    },

    // Find emoji category
    findCategory: function(emoji) {
        for (const [category, emojis] of Object.entries(TTRPGEmojis)) {
            if (emojis.includes(emoji)) {
                return category;
            }
        }
        return 'unknown';
    },

    // Get emojis by tags (searches multiple categories)
    getByTags: function(tags) {
        const results = new Set();
        tags.forEach(tag => {
            const categoryEmojis = this.getByCategory(tag);
            categoryEmojis.forEach(emoji => results.add(emoji));
            
            // Also search in other categories that might match
            Object.entries(TTRPGEmojis).forEach(([category, emojis]) => {
                if (category.includes(tag) || tag.includes(category)) {
                    emojis.forEach(emoji => results.add(emoji));
                }
            });
        });
        return Array.from(results);
    },

    // Get random emoji from category
    getRandom: function(category = null) {
        const emojiList = category ? this.getByCategory(category) : this.getAll();
        return emojiList[Math.floor(Math.random() * emojiList.length)] || 'â“';
    },

    // Create emoji picker HTML
    createPicker: function(onSelect, categories = null) {
        const picker = document.createElement('div');
        picker.className = 'emoji-picker';
        picker.style.cssText = `
            max-height: 300px;
            overflow-y: auto;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(40px, 1fr));
            gap: 0.5rem;
        `;

        const emojiList = categories ? 
            categories.map(cat => this.getByCategory(cat)).flat() : 
            this.getAll();

        emojiList.forEach(emoji => {
            const button = document.createElement('button');
            button.textContent = emoji;
            button.style.cssText = `
                font-size: 1.5rem;
                background: none;
                border: none;
                cursor: pointer;
                padding: 0.5rem;
                border-radius: 4px;
                transition: all 0.3s;
            `;
            button.onmouseover = () => button.style.background = 'var(--accent)';
            button.onmouseout = () => button.style.background = 'none';
            button.onclick = () => onSelect(emoji);
            picker.appendChild(button);
        });

        return picker;
    },

    // Suggest emojis based on text content
    suggestFromText: function(text) {
        const words = text.toLowerCase().split(/\s+/);
        const suggestions = new Set();
        
        words.forEach(word => {
            Object.entries(TTRPGEmojis).forEach(([category, emojis]) => {
                if (category.includes(word) || word.includes(category)) {
                    emojis.slice(0, 2).forEach(emoji => suggestions.add(emoji));
                }
                
                // Check if word matches common RPG terms
                const rpgTerms = {
                    'attack': ['âš”ï¸', 'ðŸ—¡ï¸', 'ðŸ¹'],
                    'defend': ['ðŸ›¡ï¸', 'âš”ï¸'],
                    'magic': ['ðŸ”®', 'âœ¨', 'ðŸŒŸ'],
                    'heal': ['â¤ï¸', 'ðŸ’š', 'ðŸ¥'],
                    'treasure': ['ðŸ’Ž', 'ðŸ†', 'ðŸ‘‘'],
                    'door': ['ðŸšª', 'ðŸ—ï¸'],
                    'secret': ['ðŸ•µï¸', 'ðŸ—ï¸'],
                    'danger': ['âš ï¸', 'ðŸ’€', 'ðŸ”¥']
                };
                
                if (rpgTerms[word]) {
                    rpgTerms[word].forEach(emoji => suggestions.add(emoji));
                }
            });
        });
        
        return Array.from(suggestions).slice(0, 6); // Return top 6 suggestions
    },

    // Add emoji to tags in notes or database entries
    enhanceTagsWithEmojis: function(tags) {
        return tags.map(tag => {
            const suggestions = this.suggestFromText(tag);
            const emoji = suggestions[0] || this.getRandom();
            return `${emoji} ${tag}`;
        });
    },

    // Parse text and replace keywords with emojis
    replaceKeywords: function(text) {
        let enhancedText = text;
        Object.entries(TTRPGEmojis).forEach(([category, emojis]) => {
            emojis.forEach(emoji => {
                // Simple keyword replacement - can be enhanced
                enhancedText = enhancedText.replace(
                    new RegExp(`\\b${category}\\b`, 'gi'), 
                    `${emoji} ${category}`
                );
            });
        });
        return enhancedText;
    }
};

// Auto-initialize emoji utilities
document.addEventListener('DOMContentLoaded', function() {
    if (!window.TTRPGEmojis) window.TTRPGEmojis = {};
    if (!window.TTRPGEmojiUtils) window.TTRPGEmojiUtils = {};
});
